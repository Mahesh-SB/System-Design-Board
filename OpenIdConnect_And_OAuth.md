
| Feature            | OAuth 2.0            | OpenID Connect (OIDC)         |
| ------------------ | -------------------- | ----------------------------- |
| Purpose            | Authorize API access | Authenticate the user         |
| Main token         | Access token         | ID token (and access token)   |
| Token type         | Opaque or JWT        | ID token is always a JWT      |
| User identity info | Not included         | Included in ID token (claims) |


‚úÖ STEP 1: Authorization Request (/authorize endpoint)

This is where the client app (frontend) redirects the user to the Authorization Server, typically in the browser.

üîπ Request Type: GET Request
```
GET https://auth-server.com/authorize?
  response_type=code
  &client_id=my-client-id
  &redirect_uri=https://myapp.com/callback
  &scope=openid profile email
  &state=af78w98fqw9
  &code_challenge=KL9asdflkjasdf9098jklsd==
  &code_challenge_method=S256
  &nonce=xyz123
```

| Parameter               | Description                                                    |
| ----------------------- | -------------------------------------------------------------- |
| `response_type`         | Must be `code` for Authorization Code flow                     |
| `client_id`             | Public identifier for your app                                 |
| `redirect_uri`          | Where to send the user after login (must match registered URI) |
| `scope`                 | Space-separated scopes (e.g., `openid profile email`)          |
| `state`                 | Random string to prevent CSRF attacks (validate on return)     |
| `code_challenge`        | (PKCE only) Hash of `code_verifier`                            |
| `code_challenge_method` | (PKCE only) Usually `S256`                                     |
| `nonce`                 | (OpenID Connect) Random string to link session ‚Üî ID token      |

nonce (üîë Number used ONCE) is a random string generated by the client application and save it in temporary memory.
Purpose : Links login request ‚Üî ID token to prevent replay or injection attacks

The id_token is a JWT and will contain the same value:
  ```
  Identity token
  {
  "iss": "https://auth-server.com",
  "aud": "my-app",
  "exp": 1691000000,
  "sub": "user123",
  "nonce": "xyz987nonce"
  }

  ```
üí° Common response_type Values

| `response_type`       | Meaning                                             | Use Case                                      |
| --------------------- | --------------------------------------------------- | --------------------------------------------- |
| `code`                | Ask for an **authorization code**                   | Most secure ‚Äî used in Authorization Code flow |
| `token`               | Ask for an **access token** directly (no code step) | Implicit flow (‚ö†Ô∏è deprecated/insecure)        |
| `id_token`            | Ask for an **ID token** only (no access token)      | OIDC login-only (no API access)               |
| `code id_token`       | Ask for **authorization code + ID token**           | Hybrid flow (rarely used today)               |
| `id_token token`      | Ask for **ID token + access token**                 | OIDC Implicit flow                            |
| `code token`          | Ask for **code + access token**                     | Legacy hybrid case                            |
| `code id_token token` | Ask for all three: code, ID token, and access token | Full hybrid flow (rare)                       |

Question : When 'response_type' is used then what's a use of 'scope' ?

| Parameter       | Purpose                                                            |
| --------------- | ------------------------------------------------------------------ |
| `response_type` | Tells the **format** of what you want back (`code`, `token`, etc.) |
| `scope`         | Tells the **content/permission** of what you're asking access to   |

üß† Scope controls what tokens contain and what APIs can be accessed

| Scope            | Effect                                             |
| ---------------- | -------------------------------------------------- |
| `openid`         | Required to get an **ID Token** (OpenID Connect)   |
| `email`          | Includes user's email in ID Token                  |
| `profile`        | Includes name, picture, etc. in ID Token           |
| `api.read`       | Allows `access_token` to access some protected API |
| `offline_access` | Returns a `refresh_token`                          |

Question 2 : What is PKCE (Proof Key for Code Exchange). why it's used in 'code_challenge' and 'code_challenge_method' ?

public clients like Single-page applications (SPA), Mobile apps, Desktop apps. Apps that can‚Äôt safely store a client_secret.
1. App Creates a long random string ‚Äî like... code_verifier = "w89_djslk34skgje2398sdkj2ksdJKsd..."
2. By applying a SHA256 hash and base64url-encoding it and get code_challenge = Base64UrlEncode(SHA256(codeVerifier));
3. pass code and method name in '&code_challenge=CHALLENGE_HASH' '&code_challenge_method=S256'
4. now the auth server knows code_challenge and method used (usually S256) But not the code_verifier yet.
5. Now, when exchanging the code for tokens, the app includes the original 'code_verifier' see below eg :
6. erver Validates SHA256(code_verifier) ‚Üí compare with original code_challenge
```
POST /token
Content-Type: application/x-www-form-urlencoded

grant_type=authorization_code
&code=AUTH_CODE
&redirect_uri=https://yourapp.com/callback
&client_id=your_client_id
&code_verifier=ORIGINAL_RANDOM_STRING

```


‚úÖ STEP 2: Token Request (/token endpoint)
This happens server-to-server, after you get the authorization_code in the callback. Your app now wants to exchange that code for tokens.

üîπ Request Type: POST Request (with PKCE, no client secret):
    Content-Type: application/x-www-form-urlencoded

```
POST https://auth-server.com/token
Content-Type: application/x-www-form-urlencoded

grant_type=authorization_code
&code=abc1234-code-here
&redirect_uri=https://myapp.com/callback
&client_id=my-client-id
&code_verifier=9sjdf98sdfjw3f89sdf

```

| Parameter       | Description                                                |
| --------------- | ---------------------------------------------------------- |
| `grant_type`    | Always `authorization_code`                                |
| `code`          | The authorization code received from Step 1                |
| `redirect_uri`  | Same URI used in `/authorize` request (must match exactly) |
| `client_id`     | Your app's client ID                                       |
| `client_secret` | (Only for confidential clients ‚Äî skip for PKCE)            |
| `code_verifier` | (PKCE only) The original random string from your app       |

üîÅ OAuth Grant Types (Token Generation Flows)

| Grant Type                 | Tokens Issued    | Suitable For            | Secure?  |
| -------------------------- | ---------------- | ----------------------- | -------  |
| Authorization Code (+PKCE) | Access + Refresh | Web/mobile apps         | ‚úÖ Yes   |
| Client Credentials         | Access           | Service-to-service APIs | ‚úÖ Yes   |
| Resource Owner Password    | Access + Refresh | Legacy apps             | ‚ùå No    |
| Implicit                   | Access           | Old SPAs                | ‚ùå No    |
| Device Code                | Access + Refresh | Devices with limited UI | ‚úÖ Yes   |






‚úÖ Summary Table

| Step         | URL               | Key Fields (Required)                                                                                     |
| ------------ | ----------------- | --------------------------------------------------------------------------------------------------------- |
| `/authorize` | Frontend redirect | `response_type`, `client_id`, `redirect_uri`, `scope`, `state`, `code_challenge`, `code_challenge_method` |
| `/token`     | Backend POST      | `grant_type`, `code`, `redirect_uri`, `client_id`, `code_verifier`                                        |

